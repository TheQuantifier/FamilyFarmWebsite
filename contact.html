<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roundelay Farm - Contact</title>
  <link rel="preload" href="images/front_yard_panos_animated_900x209.gif" as="image" />
  <link rel="stylesheet" href="common.css" />
</head>

<body>
  <div class="topnav">
    <a href="index.html">Home</a>
    <a href="products.html">Products</a>
    <a href="news.html">News</a>
    <a class="active">Contact</a>
    <a href="about.html">About</a>
  </div>

  <img src="images/front_yard_panos_animated_900x209.gif" alt="Changing seasons" class="banner-image" />

  <div class="page-fade">
    <h1>Contact Roundelay<sup>&#174;</sup> Farm</h1>

    <section class="contact-section" id="contact-section">
      <!-- Content will be injected via JavaScript -->
    </section>

    <div class="footer">
      Copyright &copy; 2023 Roundelay LLC
    </div>
  </div>

  <script>
    function handleEmailForm(event) {
      event.preventDefault();

      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const message = document.getElementById("message").value.trim();

      const subject = encodeURIComponent(`Website Inquiry from ${name}`);
      const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\n${message}`);

      window.location.href = `mailto:info@roundelay.farm?subject=${subject}&body=${body}`;
    }

    fetch('jsons/contact.json')
      .then(response => response.json())
      .then(data => {
        const section = document.getElementById('contact-section');

        const formatLabel = (key) =>
          key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ');

        const phoneHTML = `
          <h2>Phone</h2>
          <ul>
            ${Object.entries(data.phone)
              .filter(([_, number]) => number && number.trim() !== '')
              .map(([key, number]) => `<li>${formatLabel(key)}: ${number}</li>`)
              .join('\n')}
          </ul>`;

        const emailHTML = `
          <h2>Email</h2>
          <ul>
            ${Object.entries(data.email)
              .filter(([_, address]) => address && address.trim() !== '')
              .map(([key, address]) => `<li>${formatLabel(key)}: <a href="mailto:${address}">${address}</a></li>`)
              .join('\n')}
          </ul>`;

        const groupHours = (hoursObj) => {
          const days = Object.keys(hoursObj);
          const grouped = [];
          let currentGroup = [];

          const sameTime = (a, b) => hoursObj[a] === hoursObj[b];

          for (let i = 0; i < days.length; i++) {
            if (currentGroup.length === 0) {
              currentGroup.push(days[i]);
            } else if (sameTime(currentGroup[currentGroup.length - 1], days[i])) {
              currentGroup.push(days[i]);
            } else {
              grouped.push([...currentGroup]);
              currentGroup = [days[i]];
            }
          }
          if (currentGroup.length > 0) grouped.push([...currentGroup]);

          return grouped.map(group => {
            const label = group.length === 1
              ? group[0]
              : `${group[0]} â€“ ${group[group.length - 1]}`;
            return `<li>${label}: ${hoursObj[group[0]]}</li>`;
          }).join('\n');
        };

        const hoursHTML = `
          <h2>Business Hours</h2>
          <ul>
            ${groupHours(data.hours)}
          </ul>`;

        const pickupHTML = `
          <h2>Pickup Location</h2>
          <p>${data.pickup.description}</p>
          <ul>
            <li>
              Address: <a href="${data.pickup.map}" target="_blank">
                ${data.pickup.address}</a>
            </li>
          </ul>
          <div class="map-container">
            <iframe
              src="${data.pickup.embed}"
              width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Pickup Location Map">
            </iframe>
          </div>`;

        const formHTML = `
          <h2>Contact Form</h2>
          <form class="contact-form" onsubmit="handleEmailForm(event)">
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" placeholder="Jane Doe" required />
            <label for="email">Your Email:</label>
            <input type="email" id="email" name="email" placeholder="you@example.com" required />
            <label for="message">Message:</label>
            <textarea id="message" name="message" rows="5" placeholder="Type your message here..." required></textarea>
            <button type="submit">Send Message</button>
          </form>`;

        let socialHTML = '';
        const socialPlatforms = Object.entries(data.social)
          .filter(([_, url]) => url && url.trim() !== '');

        if (socialPlatforms.length > 0) {
          const links = socialPlatforms.map(([platform, url]) => {
            const name = platform.charAt(0).toUpperCase() + platform.slice(1);
            return `<a href="${url}" target="_blank">${name}</a>`;
          }).join('\n');

          socialHTML = `
            <h2>Follow Us</h2>
            <div class="social-links" style="text-align: center; margin-top: 10px;">
              ${links}
            </div>`;
        }

        section.innerHTML = `
          <p>If you have any questions about our products, events, or availability, please reach out to us using the methods below.</p>
          ${phoneHTML}
          ${emailHTML}
          ${hoursHTML}
          ${pickupHTML}
          ${formHTML}
          ${socialHTML}`;
      });
  </script>
</body>
</html>