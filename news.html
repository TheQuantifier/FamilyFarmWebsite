<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roundelay Farm - News</title>

  <!-- SEO & Social -->
  <meta name="description" content="Roundelay Farm news and updates — see what’s happening on the farm." />
  <link rel="canonical" href="https://roundelay.farm/news.html">
  <meta property="og:title" content="Roundelay Farm — News" />
  <meta property="og:description" content="See the latest news and updates from Roundelay Farm." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="images/Roundelay_jelly_1_1000x667.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#6c8a4a" />

  <link rel="preload" href="images/front_yard_panos_animated_900x209.gif" as="image" />
  <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="common.css" />
</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <nav class="topnav" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="products.html">Products</a>
    <a aria-current="page" class="active">News</a>
    <a href="contact.html">Contact</a>
    <a href="about.html">About</a>
  </nav>

  <!-- Motion-friendly banner -->
  <picture>
    <source media="(prefers-reduced-motion: reduce)" srcset="images/front_yard_panos_static_900x209.jpg" />
    <img
      src="images/front_yard_panos_animated_900x209.gif"
      alt="Changing seasons at Roundelay Farm"
      class="banner-image"
      width="900"
      height="209"
      decoding="async"
      fetchpriority="high"
    />
  </picture>

  <main id="main" class="page-fade">
    <h1>Roundelay<sup>&#174;</sup> Farm News</h1>

    <div id="news-container" aria-live="polite"></div>

    <noscript>
      <p style="text-align:center; padding: 0 20px 20px;">JavaScript is required to view news stories. Please enable JavaScript in your browser.</p>
    </noscript>

    <footer class="footer" role="contentinfo">
      &copy; 2023 Roundelay LLC &mdash; All rights reserved
    </footer>
  </main>

  <script>
    fetch('jsons/news.json', { cache: 'no-store' })
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then(stories => {
        const container = document.getElementById('news-container');
        const grouped = {};

        stories.forEach(story => {
          if (!grouped[story.date]) {
            grouped[story.date] = {
              displayDate: story.displayDate,
              stories: []
            };
          }
          grouped[story.date].stories.push(story);
        });

        Object.keys(grouped)
          .sort((a, b) => b.localeCompare(a))
          .forEach(date => {
            const group = grouped[date];
            const section = document.createElement('section');
            section.innerHTML = `<p class="news-date">${group.displayDate}</p>`;

            group.stories.forEach((story, index) => {
              const article = document.createElement('article');
              article.className = 'news-story' + (index % 2 === 1 ? ' alt' : '');
              article.setAttribute('aria-labelledby', `story-title-${date}-${index}`);

              article.innerHTML = `
                <div class="news-image">
                  <img 
                    src="${story.image}" 
                    alt="${story.title}${story.caption ? ' — ' + story.caption : ''}" 
                    loading="lazy" 
                    decoding="async"
                  >
                  ${story.caption ? `<div class="caption">${story.caption}</div>` : ''}
                </div>
                <div class="news-text">
                  <h2 id="story-title-${date}-${index}">${story.title}</h2>
                  <p>${story.content}</p>
                </div>
              `;

              section.appendChild(article);
            });

            container.appendChild(section);
          });
      })
      .catch(err => {
        console.error("Error loading news.json", err);
        document.getElementById('news-container').innerHTML =
          "<p style='text-align:center;'>Could not load news stories. Please try again later.</p>";
      });
  </script>
</body>
</html>